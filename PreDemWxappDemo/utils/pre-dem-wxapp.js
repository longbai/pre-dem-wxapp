!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("./pre-dem-wxapp-conf.js"));else if("function"==typeof define&&define.amd)define(["./pre-dem-wxapp-conf.js"],t);else{var o=t("object"==typeof exports?require("./pre-dem-wxapp-conf.js"):e["./pre-dem-wxapp-conf.js"]);for(var r in o)("object"==typeof exports?exports:e)[r]=o[r]}}("undefined"!=typeof self?self:this,function(e){return function(e){function t(r){if(o[r])return o[r].exports;var a=o[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var o={};return t.m=e,t.c=o,t.d=function(e,o,r){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,o){function r(e,t,o){e[t]?(e[k+t]=e[t],e[t]=((...r)=>{o.call(this,r,t),e[k+t].call(this,...r)})):e[t]=((...e)=>{o.call(this,...e,t)})}const a=o(1);var n,s,i,c,p,d=!1,l=!1,u=!1,g=!1,m=!1,x=!0,f=!0;const _="predem_custom_event",v="predem_http_event",y="predem_log_event",h="predem_crash_event",w="predem_app_config",S="auto_captured",k="_origin_",b=()=>{C(),T(),q(),E(),setTimeout(b,1e4)},D=(e,t)=>{var o=M();o.type="custom",o.name=e,t&&(o.content=JSON.stringify(t)),N(_,o)},O=e=>{var t=M();t.type=S,t.name="monitor",e&&(t.content=JSON.stringify(e)),N(v,t)},j=e=>{var t=M();t.type=S,t.name="log",e&&(t.content=JSON.stringify(e)),N(y,t)},J=e=>{var t=M();t.type=S,t.name="crash",e&&(t.content=JSON.stringify(e)),N(h,t)},N=(e,t)=>{wx.getStorage({key:e,success:o=>{let r=o.data;r.push(JSON.stringify(t)),wx.setStorage({key:e,data:r})},fail:()=>{let o=[JSON.stringify(t)];wx.setStorage({key:e,data:o})}})},C=()=>{u||(u=!0,wx.getStorage({key:_,success:function(e){K("custom-events",e.data,()=>{wx.removeStorage({key:_})})},complete:()=>{u=!1}}))},T=()=>{d||(d=!0,wx.getStorage({key:v,success:e=>{K("http-monitors",e.data,()=>{wx.removeStorage({key:v})})},complete:()=>{d=!1}}))},q=()=>{l||(l=!0,wx.getStorage({key:y,success:e=>{K("log-capture",e.data,e=>{wx.removeStorage({key:y})})},complete:()=>{l=!1}}))},E=()=>{g||(g=!0,wx.getStorage({key:h,success:e=>{K("crashes",e.data,e=>{wx.removeStorage({key:h})})},complete:()=>{g=!1}}))},K=(e,t,o,r)=>{let a=t.join("\n");wx.request({url:s+"/v2/"+i+"/"+e,data:a,method:"POST",success:e=>{e.statusCode>=200&&e.statusCode<300?o(e):r(e)},fail:r})},L=e=>{var t="",o="";const r=e.split("//");var a;let n=(a=1===r.length?r[0]:r[1]).indexOf("/");return-1==n?t=a:(t=a.substring(0,n),o=a.substring(n,a.length)),{domain:t,path:o}},M=()=>{const e=wx.getSystemInfoSync(),t=getCurrentPages();var o={time:Date.now(),sdk_version:"1.0.0",sdk_id:(()=>{let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const o=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?o:3&o|8).toString(16)})})(),device_model:e.model,mini_program_type:"WeChat",mini_program_version:e.version,mini_program_sdk_version:e.SDKVersion};if(c&&(o.app_version=c),n&&(o.tag=n),0!=t.length){let e=t[t.length-1].route;e&&(o.path=e)}return o};e.exports={setOpenId:e=>{n=e||""},captureCustomEvent:(e,t)=>{D(e,t)},request:e=>{var t={start_timestamp:Date.now()};if(e&&(e.method?t.method=e.method:t.method="GET",e.url)){let o=L(e.url);o&&o.domain&&(t.domain=o.domain),o&&o.path&&(t.path=o.path)}var o=Object.assign({},e);r(o,"success",e=>{t.end_timestamp=Date.now(),t.status_code=e.statusCode,e.data&&(t.data_length=JSON.stringify(e.data).length),O(t)}),r(o,"fail",e=>{t.end_timestamp=Date.now(),t.network_error_msg=e.errMsg,O(t)}),wx.request(o)},captureError:e=>{e.stack&&(e=e.stack),J({crash_log_key:e})}};const P=()=>{!0!==m&&(m=!0,void 0===p?wx.getStorage({key:w,success:function(e){void 0!==e.data&&void 0!==e.data.time&&void 0!==e.data.log_capture_enabled&&void 0!==e.data.crash_report_enabled?new Date(Date.now).toLocaleDateString===new Date(e.data.time).toLocaleDateString?(p=e.data,m=!1):A(e=>{m=!1}):A(e=>{m=!1})},fail:function(){A(e=>{m=!1})}}):new Date(Date.now).toLocaleDateString!==new Date(p.time).toLocaleDateString?A(e=>{m=!1}):m=!1)},A=e=>{K("app-config",[JSON.stringify(M())],t=>{t.data&&void 0!==t.data.log_capture_enabled&&void 0!==t.data.crash_report_enabled&&((p=t.data).time=Date.now(),wx.setStorage({key:w,data:p})),e(t)},e)};24===a.appKey.length?0!=a.domain.length?(s=a.domain,i=a.appKey.substring(0,8),c=a.appVersion||"",(()=>{const e=["debug","info","warn","error","log"];for(const t of e)r(console,t,(...e)=>{x&&(void 0===p||p.log_capture_enabled)&&j({level:t,message:e[0]})})})(),setTimeout(()=>{let t=getApp();t.dem=e.exports;var o=t.onError;let r=e=>{f&&(void 0===p||p.crash_report_enabled)&&J({crash_log_key:e})};var a=r;o&&(a=(e=>{o(e),r(e)})),App({onError:a,onShow:P})},0),P(),setTimeout(b,1e4)):console.error("请正确设置 domain，不能为空"):console.error("请正确设置 appKey，长度为 24")},function(t,o){t.exports=e}])});
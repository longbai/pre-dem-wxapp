!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("./pre-dem-wxapp-conf.js"));else if("function"==typeof define&&define.amd)define(["./pre-dem-wxapp-conf.js"],t);else{var o="object"==typeof exports?t(require("./pre-dem-wxapp-conf.js")):t(e["./pre-dem-wxapp-conf.js"]);for(var r in o)("object"==typeof exports?exports:e)[r]=o[r]}}("undefined"!=typeof self?self:this,function(e){return function(e){var t={};function o(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,o),a.l=!0,a.exports}return o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){const r=o(1);var a,n,s,i,c,p=!1,d=!1,m=!1,u=!1,l=!1,g=!1,_=!0,x=!0;const f="_origin_",v=()=>{b(),D(),j(),J(),O(),setTimeout(v,1e4)},y=(e,t)=>{var o=q();o.type="custom",o.name=e,t&&(o.content=JSON.stringify(t)),k("predem_custom_event",o)},h=e=>{var t=q();t.type="auto_captured",t.name="monitor",e&&(t.content=JSON.stringify(e)),k("predem_http_event",t)},w=e=>{var t=q();t.type="auto_captured",t.name="log",e&&(t.content=JSON.stringify(e)),k("predem_log_event",t)},S=e=>{var t=q();t.type="auto_captured",t.name="crash",e&&(t.content=JSON.stringify(e)),k("predem_crash_event",t)},k=(e,t)=>{wx.getStorage({key:e,success:o=>{let r=o.data;r.push(JSON.stringify(t)),wx.setStorage({key:e,data:r})},fail:()=>{let o=[JSON.stringify(t)];wx.setStorage({key:e,data:o})}})},b=()=>{m||(m=!0,wx.getStorage({key:"predem_custom_event",success:function(e){N("custom-events",e.data,()=>{wx.removeStorage({key:"predem_custom_event"})})},complete:()=>{m=!1}}))},D=()=>{p||(p=!0,wx.getStorage({key:"predem_http_event",success:e=>{N("http-monitors",e.data,()=>{wx.removeStorage({key:"predem_http_event"})})},complete:()=>{p=!1}}))},O=()=>{l||(l=!0,wx.getStorage({key:"predem_transaction_event",success:e=>{N("transactions",e.data,()=>{wx.removeStorage({key:"predem_transaction_event"})})},complete:()=>{l=!1}}))},j=()=>{d||(d=!0,wx.getStorage({key:"predem_log_event",success:e=>{N("log-capture",e.data,e=>{wx.removeStorage({key:"predem_log_event"})})},complete:()=>{d=!1}}))},J=()=>{u||(u=!0,wx.getStorage({key:"predem_crash_event",success:e=>{N("crashes",e.data,e=>{wx.removeStorage({key:"predem_crash_event"})})},complete:()=>{u=!1}}))},N=(e,t,o,r)=>{let a=t.join("\n");wx.request({url:n+"/v2/"+s+"/"+e,data:a,method:"POST",success:e=>{e.statusCode>=200&&e.statusCode<300?o(e):r(e)},fail:r})},C=e=>{var t="",o="";const r=e.split("//");var a;let n=(a=1===r.length?r[0]:r[1]).indexOf("/");return-1==n?t=a:(t=a.substring(0,n),o=a.substring(n,a.length)),{domain:t,path:o}};function T(e,t,o){e[t]?(e[f+t]=e[t],e[t]=((...r)=>{o.call(this,r,t),e[f+t].call(this,...r)})):e[t]=((...e)=>{o.call(this,...e,t)})}const q=()=>{const e=wx.getSystemInfoSync(),t=getCurrentPages();var o={time:Date.now(),sdk_version:"1.0.0",sdk_id:(()=>{let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const o=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?o:3&o|8).toString(16)})})(),device_model:e.model,mini_program_type:"WeChat",mini_program_version:e.version,mini_program_sdk_version:e.SDKVersion};if(i&&(o.app_version=i),a&&(o.tag=a),0!=t.length){let e=t[t.length-1].route;e&&(o.path=e)}return o};e.exports={setOpenId:e=>{a=e||""},captureCustomEvent:(e,t)=>{y(e,t)},request:e=>{var t={start_timestamp:Date.now()};if(e&&(e.method?t.method=e.method:t.method="GET",e.url)){let o=C(e.url);o&&o.domain&&(t.domain=o.domain),o&&o.path&&(t.path=o.path)}var o=Object.assign({},e);T(o,"success",e=>{t.end_timestamp=Date.now(),t.status_code=e.statusCode,e.data&&(t.data_length=JSON.stringify(e.data).length),h(t)}),T(o,"fail",e=>{t.end_timestamp=Date.now(),t.network_error_msg=e.errMsg,h(t)}),wx.request(o)},captureError:e=>{e.stack&&(e=e.stack),S({crash_log_key:e})}};const E=()=>{!0!==g&&(g=!0,void 0===c?wx.getStorage({key:"predem_app_config",success:function(e){void 0!==e.data&&void 0!==e.data.time&&void 0!==e.data.log_capture_enabled&&void 0!==e.data.crash_report_enabled&&new Date(Date.now).toLocaleDateString===new Date(e.data.time).toLocaleDateString?(c=e.data,g=!1):K(e=>{g=!1})},fail:function(){K(e=>{g=!1})}}):new Date(Date.now).toLocaleDateString!==new Date(c.time).toLocaleDateString?K(e=>{g=!1}):g=!1)},K=e=>{N("app-config",[JSON.stringify(q())],t=>{t.data&&void 0!==t.data.log_capture_enabled&&void 0!==t.data.crash_report_enabled&&((c=t.data).time=Date.now(),wx.setStorage({key:"predem_app_config",data:c})),e(t)},e)};24===r.appKey.length?0!=r.domain.length?(n=r.domain,s=r.appKey.substring(0,8),i=r.appVersion||"",(()=>{const e=["debug","info","warn","error","log"];for(const t of e)T(console,t,(...e)=>{_&&(void 0===c||c.log_capture_enabled)&&w({level:t,message:e[0]})})})(),setTimeout(()=>{let t=getApp();t.dem=e.exports;var o=t.onError;let r=e=>{x&&(void 0===c||c.crash_report_enabled)&&S({crash_log_key:e})};var a=r;o&&(a=(e=>{o(e),r(e)})),App({onError:a,onShow:E})},0),E(),setTimeout(v,1e4)):console.error("请正确设置 domain，不能为空"):console.error("请正确设置 appKey，长度为 24")},function(t,o){t.exports=e}])});
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("./pre-dem-wxapp-conf.js"));else if("function"==typeof define&&define.amd)define(["./pre-dem-wxapp-conf.js"],t);else{var a="object"==typeof exports?t(require("./pre-dem-wxapp-conf.js")):t(e["./pre-dem-wxapp-conf.js"]);for(var o in a)("object"==typeof exports?exports:e)[o]=a[o]}}("undefined"!=typeof self?self:this,function(e){return function(e){var t={};function a(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,a),r.l=!0,r.exports}return a.m=e,a.c=t,a.d=function(e,t,o){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,a){const o=a(1);var r,n,s,i,c,p=!1,d=!1,m=!1,u=!1,_=!1,l=!1,g=!0,x=!0;const f="_origin_",v=()=>{b(),O(),T(),J(),j(),setTimeout(v,1e4)},h=(e,t)=>{var a=E();a.type="custom",a.name=e,t&&(a.content=JSON.stringify(t)),D("predem_custom_event",a)},y=e=>{var t=E();t.type="auto_captured",t.name="monitor",e&&(t.content=JSON.stringify(e)),D("predem_http_event",t)},w=e=>{var t=E();t.type="auto_captured",t.name="log",e&&(t.content=JSON.stringify(e)),D("predem_log_event",t)},S=e=>{var t=E();t.type="auto_captured",t.name="crash",e&&(t.content=JSON.stringify(e)),D("predem_crash_event",t)},k=e=>{var t=E();t.type="auto_captured",t.name="auto_captured_transaction",e&&(t.content=JSON.stringify(e)),D("predem_transaction_event",t)},D=(e,t)=>{wx.getStorage({key:e,success:a=>{let o=a.data;o.push(JSON.stringify(t)),wx.setStorage({key:e,data:o})},fail:()=>{let a=[JSON.stringify(t)];wx.setStorage({key:e,data:a})}})},b=()=>{m||(m=!0,wx.getStorage({key:"predem_custom_event",success:function(e){N("custom-events",e.data,()=>{wx.removeStorage({key:"predem_custom_event"})})},complete:()=>{m=!1}}))},O=()=>{p||(p=!0,wx.getStorage({key:"predem_http_event",success:e=>{N("http-monitors",e.data,()=>{wx.removeStorage({key:"predem_http_event"})})},complete:()=>{p=!1}}))},j=()=>{_||(_=!0,wx.getStorage({key:"predem_transaction_event",success:e=>{N("transactions",e.data,()=>{wx.removeStorage({key:"predem_transaction_event"})})},complete:()=>{_=!1}}))},T=()=>{d||(d=!0,wx.getStorage({key:"predem_log_event",success:e=>{N("log-capture",e.data,e=>{wx.removeStorage({key:"predem_log_event"})})},complete:()=>{d=!1}}))},J=()=>{u||(u=!0,wx.getStorage({key:"predem_crash_event",success:e=>{N("crashes",e.data,e=>{wx.removeStorage({key:"predem_crash_event"})})},complete:()=>{u=!1}}))},N=(e,t,a,o)=>{let r=t.join("\n");wx.request({url:n+"/v2/"+s+"/"+e,data:r,method:"POST",success:e=>{e.statusCode>=200&&e.statusCode<300?a(e):o(e)},fail:o})},C=e=>{var t="",a="";const o=e.split("//");var r;let n=(r=1===o.length?o[0]:o[1]).indexOf("/");return-1==n?t=r:(t=r.substring(0,n),a=r.substring(n,r.length)),{domain:t,path:a}};function q(e,t,a){e[t]?(e[f+t]=e[t],e[t]=((...o)=>{a.call(this,o,t),e[f+t].call(this,...o)})):e[t]=((...e)=>{a.call(this,...e,t)})}const E=()=>{const e=wx.getSystemInfoSync(),t=getCurrentPages();var a={time:Date.now(),sdk_version:"1.0.0",sdk_id:(()=>{let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const a=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?a:3&a|8).toString(16)})})(),device_model:e.model,mini_program_type:"WeChat",mini_program_version:e.version,mini_program_sdk_version:e.SDKVersion};if(i&&(a.app_version=i),r&&(a.tag=r),0!=t.length){let e=t[t.length-1].route;e&&(a.path=e)}return a};e.exports={setOpenId:e=>{r=e||""},captureCustomEvent:(e,t)=>{h(e,t)},request:e=>{var t={start_timestamp:Date.now()};if(e&&(e.method?t.method=e.method:t.method="GET",e.url)){let a=C(e.url);a&&a.domain&&(t.domain=a.domain),a&&a.path&&(t.path=a.path)}var a=Object.assign({},e);q(a,"success",e=>{t.end_timestamp=Date.now(),t.status_code=e.statusCode,e.data&&(t.data_length=JSON.stringify(e.data).length),y(t)}),q(a,"fail",e=>{t.end_timestamp=Date.now(),t.network_error_msg=e.errMsg,y(t)}),wx.request(a)},captureError:e=>{e.stack&&(e=e.stack),S({crash_log_key:e})},transactionStart:e=>({start_time:(new Date).getTime(),transaction_name:e,complete:()=>{this.end_time=(new Date).getTime(),this.transaction_type=0,k(this)},cancelWithReason:e=>{this.end_time=(new Date).getTime(),this.transaction_type=1,this.reason=e,k(this)},failWithReason:e=>{this.end_time=(new Date).getTime(),this.transaction_type=2,this.reason=e,k(this)}})};const K=()=>{!0!==l&&(l=!0,void 0===c?wx.getStorage({key:"predem_app_config",success:function(e){void 0!==e.data&&void 0!==e.data.time&&void 0!==e.data.log_capture_enabled&&void 0!==e.data.crash_report_enabled&&new Date(Date.now).toLocaleDateString===new Date(e.data.time).toLocaleDateString?(c=e.data,l=!1):L(e=>{l=!1})},fail:function(){L(e=>{l=!1})}}):new Date(Date.now).toLocaleDateString!==new Date(c.time).toLocaleDateString?L(e=>{l=!1}):l=!1)},L=e=>{N("app-config",[JSON.stringify(E())],t=>{t.data&&void 0!==t.data.log_capture_enabled&&void 0!==t.data.crash_report_enabled&&((c=t.data).time=Date.now(),wx.setStorage({key:"predem_app_config",data:c})),e(t)},e)};24===o.appKey.length?0!=o.domain.length?(n=o.domain,s=o.appKey.substring(0,8),i=o.appVersion||"",(()=>{const e=["debug","info","warn","error","log"];for(const t of e)q(console,t,(...e)=>{g&&(void 0===c||c.log_capture_enabled)&&w({level:t,message:e[0]})})})(),setTimeout(()=>{let t=getApp();t.dem=e.exports;var a=t.onError;let o=e=>{x&&(void 0===c||c.crash_report_enabled)&&S({crash_log_key:e})};var r=o;a&&(r=(e=>{a(e),o(e)})),App({onError:r,onShow:K})},0),K(),setTimeout(v,1e4)):console.error("请正确设置 domain，不能为空"):console.error("请正确设置 appKey，长度为 24")},function(t,a){t.exports=e}])});